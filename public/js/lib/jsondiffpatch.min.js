/*
*   Json Diff Patch
*   ---------------
*   https://github.com/benjamine/JsonDiffPatch
*   by Benjamin Eidelman - beneidel@gmail.com
*/(function(){"use strict";var e={};typeof t!="undefined"&&(e=t);var t=e;e.version="0.0.11",e.config={textDiffMinLength:60,detectArrayMove:!0,includeValueOnArrayMove:!1};var n=typeof Array.prototype.indexOf=="function"?function(e,t){return e.indexOf(t)}:function(e,t){var n=e.length;for(var r=0;r<n;r++)if(e[r]===t)return r;return-1},r={diff:function(t,r,i,s){var o=0,u=0,a,f,l=t.length,c=r.length,h,p=[],d=[],v=typeof i=="function"?function(e,t,n,r){if(e===t)return!0;if(typeof e!="object"||typeof t!="object")return!1;var s,o;return typeof n=="number"?(s=p[n],typeof s=="undefined"&&(p[n]=s=i(e))):s=i(e),typeof r=="number"?(o=d[r],typeof o=="undefined"&&(d[r]=o=i(t))):o=i(t),s===o}:function(e,t){return e===t},m=function(e,n){return v(t[e],r[n],e,n)},g=function(e,n){if(!s)return;if(typeof t[e]!="object"||typeof r[n]!="object")return;var i=s(t[e],r[n]);if(typeof i=="undefined")return;h||(h={_t:"a"}),h[n]=i};while(o<l&&o<c&&m(o,o))g(o,o),o++;while(u+o<l&&u+o<c&&m(l-1-u,c-1-u))g(l-1-u,c-1-u),u++;if(o+u===l){if(l===c)return h;h=h||{_t:"a"};for(a=o;a<c-u;a++)h[a]=[r[a]];return h}if(o+u===c){h=h||{_t:"a"};for(a=o;a<l-u;a++)h["_"+a]=[t[a],0,0];return h}var y=this.lcs(t.slice(o,l-u),r.slice(o,c-u),{areTheSameByIndex:function(e,t){return m(e+o,t+o)}});h=h||{_t:"a"};var b=[];for(a=o;a<l-u;a++)n(y.indices1,a-o)<0&&(h["_"+a]=[t[a],0,0],b.push(a));var w=b.length;for(a=o;a<c-u;a++){var E=n(y.indices2,a-o);if(E<0){var S=!1;if(e.config.detectArrayMove&&w>0)for(f=0;f<w;f++)if(m(b[f],a)){h["_"+b[f]].splice(1,2,a,3),e.config.includeValueOnArrayMove||(h["_"+b[f]][0]=""),g(b[f],a),b.splice(f,1),S=!0;break}S||(h[a]=[r[a]])}else g(y.indices1[E]+o,y.indices2[E]+o)}return h},getArrayIndexBefore:function(e,t){var n,r=t;for(var i in e)if(e.hasOwnProperty(i)&&s(e[i])){i.slice(0,1)==="_"?n=parseInt(i.slice(1),10):n=parseInt(i,10);if(e[i].length===1){if(n<t)r--;else if(n===t)return-1}else if(e[i].length===3)if(e[i][2]===0)n<=t&&r++;else if(e[i][2]===3){n<=t&&r++;if(e[i][1]>t)r--;else if(e[i][1]===t)return n}}return r},patch:function(e,t,n,r){var i,s,o=function(e,t){return e-t},u=function(e){return function(t,n){return t[e]-n[e]}},a=[],f=[],l=[];for(i in t)if(i!=="_t")if(i[0]=="_"){if(t[i][2]!==0&&t[i][2]!==3)throw new Error("only removal or move can be applied at original array indices, invalid diff type: "+t[i][2]);a.push(parseInt(i.slice(1),10))}else t[i].length===1?f.push({index:parseInt(i,10),value:t[i][0]}):l.push({index:parseInt(i,10),diff:t[i]});a=a.sort(o);for(i=a.length-1;i>=0;i--){s=a[i];var c=t["_"+s],h=e.splice(s,1)[0];c[2]===3&&f.push({index:c[1],value:h})}f=f.sort(u("index"));var p=f.length;for(i=0;i<p;i++){var d=f[i];e.splice(d.index,0,d.value)}var v=l.length;if(v>0){if(typeof n!="function")throw new Error("to patch items in the array an objectInnerPatch function must be provided");for(i=0;i<v;i++){var m=l[i];n(e,m.index.toString(),m.diff,r)}}return e},lcs:function(e,t,n){n.areTheSameByIndex=n.areTheSameByIndex||function(n,r){return e[n]===t[r]};var r=this.lengthMatrix(e,t,n),i=this.backtrack(r,e,t,e.length,t.length);return typeof e=="string"&&typeof t=="string"&&(i.sequence=i.sequence.join("")),i},lengthMatrix:function(e,t,n){var r=e.length,i=t.length,s,o,u=[r+1];for(s=0;s<r+1;s++){u[s]=[i+1];for(o=0;o<i+1;o++)u[s][o]=0}u.options=n;for(s=1;s<r+1;s++)for(o=1;o<i+1;o++)n.areTheSameByIndex(s-1,o-1)?u[s][o]=u[s-1][o-1]+1:u[s][o]=Math.max(u[s-1][o],u[s][o-1]);return u},backtrack:function(e,t,n,r,i){if(r===0||i===0)return{sequence:[],indices1:[],indices2:[]};if(e.options.areTheSameByIndex(r-1,i-1)){var s=this.backtrack(e,t,n,r-1,i-1);return s.sequence.push(t[r-1]),s.indices1.push(r-1),s.indices2.push(i-1),s}return e[r][i-1]>e[r-1][i]?this.backtrack(e,t,n,r,i-1):this.backtrack(e,t,n,r-1,i)}};e.sequenceDiffer=r,e.dateReviver=function(e,t){var n;if(typeof t=="string"){n=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)(Z|([+\-])(\d{2}):(\d{2}))$/.exec(t);if(n)return new Date(Date.UTC(+n[1],+n[2]-1,+n[3],+n[4],+n[5],+n[6]))}return t};var i=function(){var t;e.config.diff_match_patch&&(t=new e.config.diff_match_patch.diff_match_patch),typeof diff_match_patch!="undefined"&&(typeof diff_match_patch=="function"?t=new diff_match_patch:typeof diff_match_patch=="object"&&typeof diff_match_patch.diff_match_patch=="function"&&(t=new diff_match_patch.diff_match_patch));if(t)return e.config.textDiff=function(e,n){return t.patch_toText(t.patch_make(e,n))},e.config.textPatch=function(e,n){var r=t.patch_apply(t.patch_fromText(n),e);for(var i=0;i<r[1].length;i++)if(!r[1][i])throw new Error("text patch failed");return r[0]},!0},s=e.isArray=typeof Array.isArray=="function"?Array.isArray:function(e){return typeof e=="object"&&e instanceof Array},o=e.isDate=function(e){return e instanceof Date||Object.prototype.toString.call(e)==="[object Date]"},u=function(t,n){return r.diff(t,n,e.config.objectHash,e.diff)},a=function(e,t){var n,r,i,s;s=function(i){r=f(e[i],t[i]),typeof r!="undefined"&&(typeof n=="undefined"&&(n={}),n[i]=r)};for(i in t)t.hasOwnProperty(i)&&s(i);for(i in e)e.hasOwnProperty(i)&&typeof t[i]=="undefined"&&s(i);return n},f=e.diff=function(t,n){var r,f,l,c,h;if(t===n)return;if(t!==t&&n!==n)return;r=typeof n,f=typeof t,l=n===null,c=t===null,f=="object"&&o(t)&&(f="date");if(r=="object"&&o(n)){r="date";if(f=="date"&&t.getTime()===n.getTime())return}if(l||c||r=="undefined"||r!=f||r=="number"||f=="number"||r=="boolean"||f=="boolean"||r=="string"||f=="string"||r=="date"||f=="date"||r==="object"&&s(n)!=s(t)){h=[];if(typeof t!="undefined")if(typeof n!="undefined"){var p=r=="string"&&f=="string"&&Math.min(t.length,n.length)>e.config.textDiffMinLength;p&&!e.config.textDiff&&i(),p&&e.config.textDiff?h.push(e.config.textDiff(t,n),0,2):(h.push(t),h.push(n))}else h.push(t),h.push(0,0);else h.push(n);return h}return s(n)?u(t,n):a(t,n)},l=function(e,t){return s(e)?e[parseInt(t,10)]:e[t]};e.getByKey=l;var c=function(e,t,n){if(s(e)&&e._key){var r=e._key;typeof e._key!="function"&&(r=function(t){return t[e._key]});for(var i=0;i<e.length;i++)if(r(e[i])===t){typeof n=="undefined"?(e.splice(i,1),i--):e[i]=n;return}typeof n!="undefined"&&e.push(n);return}typeof n=="undefined"?s(e)?e.splice(t,1):delete e[t]:e[t]=n},h=function(t){return e.config.textDiffReverse||(e.config.textDiffReverse=function(e){var t,n,r,i,s,o=null,u=/^@@ +\-(\d+),(\d+) +\+(\d+),(\d+) +@@$/,a,f,l,c=function(){f!==null&&(r[f]="-"+r[f].slice(1)),l!==null&&(r[l]="+"+r[l].slice(1),f!==null&&(s=r[f],r[f]=r[l],r[l]=s)),r[a]="@@ -"+o[3]+","+o[4]+" +"+o[1]+","+o[2]+" @@",o=null,a=null,f=null,l=null};r=e.split("\n");for(t=0,n=r.length;t<n;t++){i=r[t];var h=i.slice(0,1);h==="@"?(o!==null,o=u.exec(i),a=t,f=null,l=null,r[a]="@@ -"+o[3]+","+o[4]+" +"+o[1]+","+o[2]+" @@"):h=="+"?(f=t,r[t]="-"+r[t].slice(1)):h=="-"&&(l=t,r[t]="+"+r[t].slice(1))}return o!==null,r.join("\n")}),e.config.textDiffReverse(t)},p=e.reverse=function(e){var t,n;if(typeof e=="undefined")return;if(e===null)return null;if(typeof e=="object"&&!o(e)){if(s(e)){if(e.length<3)return e.length===1?[e[0],0,0]:[e[1],e[0]];if(e[2]===0)return[e[0]];if(e[2]===2)return[h(e[0]),0,2];throw new Error("invalid diff type")}n={};if(e._t==="a"){for(t in e)if(e.hasOwnProperty(t)&&t!=="_t"){var i,u=t;t.slice(0,1)==="_"?i=parseInt(t.slice(1),10):i=parseInt(t,10);if(s(e[t]))if(e[t].length===1)u="_"+i;else if(e[t].length===2)u=r.getArrayIndexBefore(e,i);else if(e[t][2]===0)u=i.toString();else{if(e[t][2]===3){u="_"+e[t][1],n[u]=[e[t][0],i,3];continue}u=r.getArrayIndexBefore(e,i)}else u=r.getArrayIndexBefore(e,i);n[u]=p(e[t])}n._t="a"}else for(t in e)e.hasOwnProperty(t)&&(n[t]=p(e[t]));return n}return typeof e=="string"&&e.slice(0,2)==="@@"?h(e):e},d=e.patch=function(n,o,u,a){var f,h,p="",v;typeof o!="string"?(a=u,u=o,o=null):typeof n!="object"&&(o=null),a&&(p+=a),p+="/",o!==null&&(p+=o);if(typeof u=="object")if(s(u)){if(u.length<3)return h=u[u.length-1],o!==null&&c(n,o,h),h;if(u[2]!==0){if(u[2]===2){e.config.textPatch||i();if(!e.config.textPatch)throw new Error("textPatch function not found");try{h=e.config.textPatch(l(n,o),u[0])}catch(m){throw new Error('cannot apply patch at "'+p+'": '+m)}return o!==null&&c(n,o,h),h}throw u[2]===3?new Error("Not implemented diff type: "+u[2]):new Error("invalid diff type: "+u[2])}if(o===null)return;c(n,o)}else if(u._t=="a"){v=o===null?n:l(n,o);if(typeof v!="object"||!s(v))throw new Error('cannot apply patch at "'+p+'": array expected');r.patch(v,u,t.patch,p)}else{v=o===null?n:l(n,o);if(typeof v!="object"||s(v))throw new Error('cannot apply patch at "'+p+'": object expected');for(f in u)u.hasOwnProperty(f)&&d(v,f,u[f],p)}return n},v=e.unpatch=function(e,t,n,r){return typeof t!="string"?d(e,p(t),n):d(e,t,p(n),r)};typeof require=="function"&&typeof exports=="object"&&typeof module=="object"?module.exports=e:typeof define=="function"&&define.amd?define(e):typeof window!="undefined"?window.jsondiffpatch=e:self.jsondiffpatch=e})();