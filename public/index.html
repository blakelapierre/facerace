<!doctype html>
<html ng-app="facerace">
<head>
	<title>Face Race</title>

	<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">

	<script type="text/javascript" src="/js/lib/jquery.2.0.3.min.js"></script>
	<script type="text/javascript" src="/js/lib/angular.1.2.0rc1.min.js"></script>
	<script type="text/javascript" src="/js/lib/underscore.1.4.4.js"></script>
	<script type="text/javascript" src="/js/lib/gl-matrix-min.js"></script>
	<script type="text/javascript" src="/js/lib/three.min.js"></script>
	<script type="text/javascript" src="/js/lib/stats.min.js"></script>
	<script type="text/javascript" src="/js/lib/jsoneditor-min.js"></script>
	<script type="text/javascript" src="/js/lib/ShaderParticles.min.js"></script>
	<script type="text/javascript" src="/js/lib/gestures.js"></script>
	<script type="text/javascript" src="/js/lib/smoothie.1.19.js"></script>

	<script type="text/javascript" src="/socket.io/socket.io.js"></script>

	<script type="text/javascript" src="/game/cameras/driveCamera.js"></script>
	<script type="text/javascript" src="/game/simulator2.js"></script>
	<script type="text/javascript" src="/game/gameClient.js"></script>
	
	<script type="text/javascript" src="/js/facerace/debug.js"></script>
	<script type="text/javascript" src="/js/facerace/client.js"></script>

	
	<link rel="stylesheet" href="/css/bootstrap.min.css" />
	<link rel="stylesheet" href="/css/jsoneditor-min.css" />
	<link rel="stylesheet" href="/css/facerace.css" />
</head>
<body ng-controller="ClientCtrl">
	
	<div class="info" ng-show="infoVisible">
		<div orientation-metrics class="orientation">
			<canvas class="alpha" width="300" height="50"></canvas>
			<canvas class="beta" width="300" height="50"></canvas>
			<canvas class="gamma" width="300" height="50"></canvas>
		</div>
		<div class="scoreboard">
			<table>
				<thead>
					<tr>
						<td>Name</td>
						<td>Ping</td>
					</tr>
				</thead>
				<tr class="player-score" ng-repeat="player in faceraceClient.world.players">
					<td>{{player.name}}</td>
					<td>{{player.latency}}</td>
				</tr>
			</table>
		</div>
	</div>

	<!-- <div vehicle-instrumentation target="debugObject.playerMetrics" class="vehicle-instrumentation">
		<canvas ng-repeat="metric in metrics" ng-init="canvasCreated(metric)" class="{{metric}}" width="300" height="50"></canvas>
	</div> -->
	
	

	<div id="configPanel" ng-class="{'show-config': configVisible}" class="config-panel">
		<div object-editor object="debugObject"></div>
		<!-- <editobject object="debugObject"></editobject> -->

		<!-- <div ng-repeat="(key, value) in debugObject.config.camera">
			<label>{{key}}</label>
			<input type="range" step="1" ng-model="config.camera[key]" /> {{value}}
		</div>
		<div ng-repeat="(key, value) in debugObject.playerMetrics">
			<label>{{key}}</label>
			<span>{{value}}</span>
		</div> -->
	</div>
	
	<camera show-camera="showCamera" face-data="faceData"></camera>
	
	<div scene ng-class="{'show-config': configVisible}" class="client" player-controller>
		<div class="dashboard">
			<span class="glyphicon glyphicon-arrow-down" ng-show="controls.down"></span>
			<span class="glyphicon glyphicon-arrow-up" ng-show="controls.up"></span>
			<span class="glyphicon glyphicon-arrow-left" ng-show="controls.left"></span>
			<span class="glyphicon glyphicon-arrow-right" ng-show="controls.right"></span>
		</div>

		<div id="accelerator" class="accelerator" ng-click="accelerate()"></div>
		<div id="calibrate" hm-tap="calibrate()">Calibrate</div>
		<div id="brake" class="brake" ng-click="brake()"></div>
	</div>


	<script id="plane-vertex-shader" type="x-shader/x-vertex">
		varying vec2 vUv;

		void main()
		{
		    vUv = uv;
		    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
		}
	</script>

	<script id="plane-fragment-shader" type="x-shader/x-fragment">
		#ifdef GL_ES
		precision highp float;
		#endif

		uniform sampler2D texture;
		uniform float width;
		uniform float height;
		varying vec2 vUv;

		void main(void)
		{
		    vec2 position = vUv;

		    float midX = width / 2.0;
		    float midY = height / 2.0;

		    vec4 color = texture2D(texture, position);

		    color[3] = position[0] / width;

		    gl_FragColor = color;
		}
	</script>

	<script id="plane-vertex-shader-swirl" type="x-shader/x-vertex">
		varying vec2 vUv;

		void main()
		{
		    vUv = uv;
		    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
		}
	</script>

	<script id="plane-fragment-shader-swirl" type="x-shader/x-fragment">
		// Scene buffer
		uniform sampler2D texture; 

		uniform float time;

		uniform float width;
		uniform float height;

		// Swirl effect parameters
		uniform float radius;
		uniform float angle;
		uniform vec2 center;

		varying vec2 vUv;

		vec4 PostFX(sampler2D texture, vec2 uv, float time)
		{
		  vec2 texSize = vec2(width, height);
		  vec2 tc = uv * texSize;
		  tc -= center;
		  float dist = length(tc);
		  if (dist < radius) 
		  {
		    float percent = (radius - dist) / radius;
		    float theta = percent * percent * angle * 8.0;
		    float s = sin(theta);
		    float c = cos(theta);
		    tc = vec2(dot(tc, vec2(c, -s)), dot(tc, vec2(s, c)));
		  }
		  tc += center;
		  vec3 color = texture2D(texture, tc / texSize).rgb;
		  return vec4(color, 1.0);
		}

		void main (void)
		{
		  gl_FragColor = PostFX(texture, vUv, time);
		}
	</script>
</body>
</html>