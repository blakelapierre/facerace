<!doctype html>
<html ng-app="facerace">
<head>
	<title>Face Race</title>

	<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">

	<script type="text/javascript" src="/js/lib/jquery.2.0.3.min.js"></script>
	<script type="text/javascript" src="/js/lib/angular.1.2.0rc1.min.js"></script>
	<script type="text/javascript" src="/js/lib/underscore.1.4.4.js"></script>
	<script type="text/javascript" src="/js/lib/gl-matrix-min.js"></script>
	<script type="text/javascript" src="/js/lib/three.min.js"></script>
	<script type="text/javascript" src="/js/lib/stats.min.js"></script>
	<script type="text/javascript" src="/js/lib/jsoneditor-min.js"></script>
	<script type="text/javascript" src="/js/lib/ShaderParticles.min.js"></script>
	<script type="text/javascript" src="/js/lib/gestures.js"></script>
	<script type="text/javascript" src="/js/lib/smoothie.1.19.js"></script>

	<script type="text/javascript" src="/socket.io/socket.io.js"></script>

	<script type="text/javascript" src="/game/cameras/driveCamera.js"></script>
	<script type="text/javascript" src="/game/player.js"></script>
	<script type="text/javascript" src="/game/world.js"></script>
	<script type="text/javascript" src="/game/simulator.js"></script>
	<script type="text/javascript" src="/game/gameClient.js"></script>

	<script type="text/javascript" src="/js/facerace/app.js"></script>
	<script type="text/javascript" src="/js/facerace/facerace.js"></script>
	<script type="text/javascript" src="/js/facerace/debug.js"></script>
	<script type="text/javascript" src="/js/facerace/scene/scene.js"></script>
	<script type="text/javascript" src="/js/facerace/scene/camera.js"></script>
	<script type="text/javascript" src="/js/facerace/input/playerController.js"></script>
	<script type="text/javascript" src="/js/facerace/hud/orientationMetrics.js"></script>
	<script type="text/javascript" src="/js/facerace/hud/vehicleInstrumentation.js"></script>
	<script type="text/javascript" src="/js/facerace/hud/messageArea.js"></script>

	
	<link rel="stylesheet" href="/css/bootstrap.min.css" />
	<link rel="stylesheet" href="/css/jsoneditor-min.css" />
	<link rel="stylesheet" href="/css/facerace.css" />
</head>
<body>
	
	<facerace class="facerace">

		<div class="info" ng-show="infoVisible">
			<!-- <div class="mask"></div> -->
			<div orientation-metrics class="orientation">
				<canvas class="alpha" width="300" height="50"></canvas>
				<canvas class="beta" width="300" height="50"></canvas>
				<canvas class="gamma" width="300" height="50"></canvas>
			</div>
			<div class="scoreboard">
				<table class="table">
					<thead>
						<tr>
							<th class="text-center">Face</th>
							<th class="text-center">Name</th>
							<th class="text-center">Ping</th>
						</tr>
					</thead>
					<tbody>
						<tr class="player-score" ng-repeat="player in faceraceClient.world.players">
							<td class="text-center"><img src="{{player.face}}" /></td>
							<td class="text-center">{{player.name}}</td>
							<td class="text-center">{{player.latency}}</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>

		<!-- <div vehicle-instrumentation target="debugObject.playerMetrics" class="vehicle-instrumentation">
			<canvas ng-repeat="metric in metrics" ng-init="canvasCreated(metric)" class="{{metric}}" width="300" height="50"></canvas>
		</div> -->
		
		<camera show-camera="showCamera" face-data="faceData"></camera>
		
		<div id="configPanel" ng-class="{'show-config': configVisible}" class="config-panel">
			<div object-editor object="debugObject"></div>
		</div>

		<div scene ng-class="{'show-config': configVisible}" class="client" player-controller>
			<div class="dashboard">
				<span class="glyphicon glyphicon-arrow-down" ng-show="controls.down"></span>
				<span class="glyphicon glyphicon-arrow-up" ng-show="controls.up"></span>
				<span class="glyphicon glyphicon-arrow-left" ng-show="controls.left"></span>
				<span class="glyphicon glyphicon-arrow-right" ng-show="controls.right"></span>
			</div>

			<message-area></message-area>

			<div id="accelerator" class="accelerator" ng-click="accelerate()"></div>
			<div id="calibrate" hm-tap="calibrate()">Calibrate</div>
			<div id="brake" class="brake" ng-click="brake()"></div>
		</div>
		<div class="overlay">
			<span>{{metrics.latency}} ms</span>
		</div>
	</facerace>


<!-- Shaders -->
	<script id="plane-vertex-shader" type="x-shader/x-vertex">
		varying vec2 vUv;

		void main()
		{
		    vUv = uv;
		    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
		}
	</script>

	<script id="plane-fragment-shader" type="x-shader/x-fragment">
		#ifdef GL_ES
		precision highp float;
		#endif

		uniform sampler2D texture;
		uniform float width;
		uniform float height;
		varying vec2 vUv;

		void main(void)
		{
		    vec2 position = vUv;

		    float midX = width / 2.0;
		    float midY = height / 2.0;

		    vec4 color = texture2D(texture, position);

		    color[3] = position[0] / width;

		    gl_FragColor = color;
		}
	</script>

	<script id="plane-vertex-shader-swirl" type="x-shader/x-vertex">
		varying vec2 vUv;

		void main()
		{
		    vUv = uv;
		    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
		}
	</script>

	<script id="plane-fragment-shader-swirl" type="x-shader/x-fragment">
		// Scene buffer
		uniform sampler2D texture; 

		uniform float time;

		uniform float width;
		uniform float height;

		// Swirl effect parameters
		uniform float radius;
		uniform float angle;
		uniform vec2 center;

		varying vec2 vUv;

		vec4 PostFX(sampler2D texture, vec2 uv, float time)
		{
		  vec2 texSize = vec2(width, height);
		  vec2 tc = uv * texSize;
		  tc -= center;
		  float dist = length(tc) * 2.0 * sin(time / 10.0);
		  if (dist < radius) 
		  {
		    float percent = (radius - dist) / radius;
		    float theta = percent * percent * angle * 8.0;
		    float s = sin(theta);
		    float c = cos(theta);
		    tc = vec2(dot(tc, vec2(c, -s)), dot(tc, vec2(s, c)));
		  }
		  tc += center;
		  vec3 color = texture2D(texture, tc / texSize).rgb;
		  return vec4(color, 1.0);
		}

		void main (void)
		{
		  gl_FragColor = PostFX(texture, vUv, time);
		}
	</script>
</body>
</html>